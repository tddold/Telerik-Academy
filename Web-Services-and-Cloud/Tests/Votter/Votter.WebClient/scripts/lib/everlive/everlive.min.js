/*!
The MIT License (MIT)

Copyright (c) 2013 Telerik AD

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.y distributed under the MIT license.
*/
/*!
 Everlive SDK
 Version 1.2.5
 */
(function(a,b){if(typeof define==="function"&&define.amd){define(["underscore","rsvp","reqwest","jstz"],function(f,e,c,d){return(a.Everlive=b(f,e,c,d))})}else{if(typeof exports==="object"){module.exports=b(require("underscore"),require("rsvp"))}else{a.Everlive=b(a._,a.RSVP,a.reqwest,a.jstz)}}}(this,function(z,i,k,f){var p=Array.prototype.slice;var B="//api.everlive.com/v1/";var g="Id";function a(E,C,D){if(!D){D="The "+C+" is required"}if(typeof E==="undefined"||E===null){throw new Error(D)}}function v(C){this.url=B;this.apiKey=null;this.masterKey=null;this.token=null;this.tokenType=null;this.scheme="http";this.parseOnlyCompleteDateTimeObjects=false;if(typeof C==="string"){this.apiKey=C}else{z.extend(this,C)}}var s=[];function r(D){var C=this;this.setup=new v(D);z.each(s,function(E){E.func.call(C,D)});if(r.$===null){r.$=C}}r.$=null;r.idField=g;r.initializations=s;r.init=function(C){r.$=null;return new r(C)};r.buildUrl=function(C){var D="";if(typeof C.scheme==="string"){D+=C.scheme+":"}D+=C.url;if(C.apiKey){D+=C.apiKey+"/"}return D};r.prototype.data=function(C){return new d(this.setup,C)};r.prototype.buildUrl=function(){return r.buildUrl(this.setup)};var q=function(D,E){var C=null;if(E&&E.authHeaders===false){return C}if(D.token){C=(D.tokenType||"bearer")+" "+D.token}else{if(D.masterKey){C="masterkey "+D.masterKey}}if(C){return{Authorization:C}}else{return null}};r.prototype.buildAuthHeader=function(){return q(this.setup)};(function(){var I={query:1,where:100,filter:101,and:110,or:111,not:112,equal:120,not_equal:121,lt:122,lte:123,gt:124,gte:125,isin:126,notin:127,all:128,size:129,regex:130,contains:131,startsWith:132,endsWith:133,nearShpere:140,withinBox:141,withinPolygon:142,withinShpere:143,select:200,exclude:201,order:300,order_desc:301,skip:400,take:401,expand:402};function E(J,K){this.operator=J;this.operands=K||[]}E.prototype={addOperand:function(J){this.operands.push(J)}};function D(N,J,L,O,K,M){this.filter=N;this.fields=J;this.sort=L;this.toskip=O;this.totake=K;this.expandExpression=M;this.expr=new E(I.query)}D.prototype={where:function(J){if(J){return this._simple(I.filter,[J])}else{return new H(this)}},select:function(){return this._simple(I.select,arguments)},order:function(J){return this._simple(I.order,[J])},orderDesc:function(J){return this._simple(I.order_desc,[J])},skip:function(J){return this._simple(I.skip,[J])},take:function(J){return this._simple(I.take,[J])},expand:function(J){return this._simple(I.expand,[J])},build:function(){return new G(this).build()},_simple:function(L,J){var K=p.call(J);this.expr.addOperand(new E(L,K));return this}};function H(L,K,J){this.parent=L;this.single=J;this.expr=new E(K||I.where);this.parent.expr.addOperand(this.expr)}H.prototype={and:function(){return new H(this,I.and)},or:function(){return new H(this,I.or)},not:function(){return new H(this,I.not,true)},_simple:function(J){var K=p.call(arguments,1);this.expr.addOperand(new E(J,K));return this._done()},eq:function(K,J){return this._simple(I.equal,K,J)},ne:function(K,J){return this._simple(I.not_equal,K,J)},gt:function(K,J){return this._simple(I.gt,K,J)},gte:function(K,J){return this._simple(I.gte,K,J)},lt:function(K,J){return this._simple(I.lt,K,J)},lte:function(K,J){return this._simple(I.lte,K,J)},isin:function(K,J){return this._simple(I.isin,K,J)},notin:function(K,J){return this._simple(I.notin,K,J)},all:function(K,J){return this._simple(I.all,K,J)},size:function(K,J){return this._simple(I.size,K,J)},regex:function(L,K,J){return this._simple(I.regex,L,K,J)},startsWith:function(L,K,J){return this._simple(I.startsWith,L,K,J)},endsWith:function(L,K,J){return this._simple(I.endsWith,L,K,J)},nearSphere:function(L,J,M,K){return this._simple(I.nearShpere,L,J,M,K)},withinBox:function(K,L,J){return this._simple(I.withinBox,K,L,J)},withinPolygon:function(K,J){return this._simple(I.withinPolygon,K,J)},withinCenterSphere:function(M,K,J,L){return this._simple(I.withinShpere,M,K,J,L)},done:function(){if(this.parent instanceof H){return this.parent._done()}else{return this.parent}},_done:function(){if(this.single){return this.parent}else{return this}}};H.prototype.equal=H.prototype.eq;H.prototype.notEqual=H.prototype.ne;H.prototype.greaterThan=H.prototype.gt;H.prototype.greaterThanEqual=H.prototype.gte;H.prototype.lessThan=H.prototype.lt;H.prototype.lessThanEqual=H.prototype.lte;function G(J){this.query=J;this.expr=J.expr}var C={radians:"$maxDistance",km:"$maxDistanceInKilometers",miles:"$maxDistanceInMiles"};var F={radians:"radius",km:"radiusInKilometers",miles:"radiusInMiles"};G.prototype={build:function(){var J=this.query;if(J.filter||J.fields||J.sort||J.toskip||J.totake||J.expandExpression){return{$where:J.filter||null,$select:J.fields||null,$sort:J.sort||null,$skip:J.toskip||null,$take:J.totake||null,$expand:J.expandExpression||null}}return{$where:this._buildWhere(),$select:this._buildSelect(),$sort:this._buildSort(),$skip:this._getSkip(),$take:this._getTake(),$expand:this._getExpand()}},_getSkip:function(){var J=z.find(this.expr.operands,function(M,K,L){return M.operator===I.skip});return J?J.operands[0]:null},_getTake:function(){var J=z.find(this.expr.operands,function(M,K,L){return M.operator===I.take});return J?J.operands[0]:null},_getExpand:function(){var J=z.find(this.expr.operands,function(M,K,L){return M.operator===I.expand});return J?J.operands[0]:null},_buildSelect:function(){var K=z.find(this.expr.operands,function(N,L,M){return N.operator===I.select});var J={};if(K){z.reduce(K.operands,function(L,M){L[M]=1;return L},J);return J}else{return null}},_buildSort:function(){var K=z.filter(this.expr.operands,function(N,L,M){return N.operator===I.order||N.operator===I.order_desc});var J={};if(K.length>0){z.reduce(K,function(L,M){L[M.operands[0]]=M.operator===I.order?1:-1;return L},J);return J}else{return null}},_buildWhere:function(){var J=z.find(this.expr.operands,function(N,L,M){return N.operator===I.where});if(J){return this._build(new E(I.and,J.operands))}else{var K=z.find(this.expr.operands,function(N,L,M){return N.operator===I.filter});if(K){return K.operands[0]}return null}},_build:function(J){if(this._isSimple(J)){return this._simple(J)}else{if(this._isRegex(J)){return this._regex(J)}else{if(this._isGeo(J)){return this._geo(J)}else{if(this._isAnd(J)){return this._and(J)}else{if(this._isOr(J)){return this._or(J)}else{if(this._isNot(J)){return this._not(J)}}}}}}},_isSimple:function(J){return J.operator>=I.equal&&J.operator<=I.size},_simple:function(N){var M={},J={};var L=N.operands;var K=this._translateoperator(N.operator);if(K){M[K]=L[1]}else{M=L[1]}J[L[0]]=M;return J},_isRegex:function(J){return J.operator>=I.regex&&J.operator<=I.endsWith},_regex:function(N){var J={};var M=this._getRegex(N);var K=this._getRegexValue(M);var L=N.operands;J[L[0]]=K;return J},_getRegex:function(L){var K=L.operands[1];var J=L.operands[2]?L.operands[2]:"";switch(L.operator){case I.regex:return K instanceof RegExp?K:new RegExp(K,J);case I.startsWith:return new RegExp("^"+K,J);case I.endsWith:return new RegExp(K+"$",J);default:throw new Error("Unknown operator type.")}},_getRegexValue:function(K){var J="";if(K.global){J+="g"}if(K.multiline){J+="m"}if(K.ignoreCase){J+="i"}return{$regex:K.source,$options:J}},_isGeo:function(J){return J.operator>=I.nearShpere&&J.operator<=I.withinShpere},_geo:function(L){var J={};var K=L.operands;J[K[0]]=this._getGeoTerm(L);return J},_getGeoTerm:function(J){switch(J.operator){case I.nearShpere:return this._getNearSphereTerm(J);case I.withinBox:return this._getWithinBox(J);case I.withinPolygon:return this._getWithinPolygon(J);case I.withinShpere:return this._getWithinCenterSphere(J);default:throw new Error("Unknown operator type.")}},_getNearSphereTerm:function(P){var L=P.operands;var J=this._getGeoPoint(L[1]);var O=L[2];var N=L[3];var K;var M={"$nearSphere":J};if(typeof O!=="undefined"){K=C[N]||C.radians;M[K]=O}return M},_getWithinBox:function(M){var K=M.operands;var J=this._getGeoPoint(K[1]);var L=this._getGeoPoint(K[2]);return{"$within":{"$box":[J,L]}}},_getWithinPolygon:function(L){var J=L.operands;var K=this._getGeoPoints(J[1]);return{"$within":{"$polygon":K}}},_getWithinCenterSphere:function(P){var N=P.operands;var K=this._getGeoPoint(N[1]);var J=N[2];var O=N[3];var L=F[O]||F.radians;var M={center:K};M[L]=J;return{"$within":{"$centerSphere":M}}},_getGeoPoint:function(J){if(z.isArray(J)){return new l(J[0],J[1])}return J},_getGeoPoints:function(K){var J=this;return z.map(K,function(L){return J._getGeoPoint(L)})},_isAnd:function(J){return J.operator===I.and},_and:function(O){var N,K,M,J={};var L=O.operands;for(N=0,K=L.length;N<K;N++){M=this._build(L[N]);J=this._andAppend(J,M)}return J},_andAppend:function(N,K){var M,J,L,P,Q;var O=z.keys(K);for(M=0,J=O.length;M<J;M++){L=O[M];P=N[L];if(typeof P==="undefined"){N[L]=K[L]}else{Q=K[L];if(typeof P==="object"&&typeof Q==="object"){P=z.extend(P,Q)}else{P=Q}N[L]=P}}return N},_isOr:function(J){return J.operator===I.or},_or:function(O){var N,K,M,J=[];var L=O.operands;for(N=0,K=L.length;N<K;N++){M=this._build(L[N]);J.push(M)}return{$or:J}},_isNot:function(J){return J.operator===I.not},_not:function(J){return{$not:this._build(J.operands[0])}},_translateoperator:function(J){switch(J){case I.equal:return null;case I.not_equal:return"$ne";case I.gt:return"$gt";case I.lt:return"$lt";case I.gte:return"$gte";case I.lte:return"$lte";case I.isin:return"$in";case I.notin:return"$nin";case I.all:return"$all";case I.size:return"$size"}throw new Error("Unknown operator type.")}};r.Query=D;r.QueryBuilder=G}());var u=(function(){var N={filter:"X-Everlive-Filter",select:"X-Everlive-Fields",sort:"X-Everlive-Sort",skip:"X-Everlive-Skip",take:"X-Everlive-Take",expand:"X-Everlive-Expand"};var J=null;function D(P,Q){a(P,"setup");a(Q,"options");this.setup=P;this.method=null;this.endpoint=null;this.data=null;this.headers={};this.success=null;this.error=null;this.parse=D.parsers.simple;z.extend(this,Q);this._init(Q);J=this}D.prototype={send:function(){r.sendRequest(this)},buildAuthHeader:q,buildUrl:function L(P){return r.buildUrl(P)},buildQueryHeaders:function G(P){if(P){if(P instanceof r.Query){return D.prototype._buildQueryHeaders(P)}else{return D.prototype._buildFilterHeader(P)}}else{return{}}},_init:function(P){z.extend(this.headers,this.buildAuthHeader(this.setup,P),this.buildQueryHeaders(P.filter),P.headers)},_buildQueryHeaders:function(P){P=P.build();var Q={};if(P.$where!==null){Q[N.filter]=JSON.stringify(P.$where)}if(P.$select!==null){Q[N.select]=JSON.stringify(P.$select)}if(P.$sort!==null){Q[N.sort]=JSON.stringify(P.$sort)}if(P.$skip!==null){Q[N.skip]=P.$skip}if(P.$take!==null){Q[N.take]=P.$take}if(P.$expand!==null){Q[N.expand]=JSON.stringify(P.$expand)}return Q},_buildFilterHeader:function(P){var Q={};Q[N.filter]=JSON.stringify(P);return Q}};r.Request=D;r.prototype.request=function(P){return new D(this.setup,P)};function O(T){if(J&&J.setup&&J.setup.parseOnlyCompleteDateTimeObjects){if(/^\d{4}-\d{2}-\d{2}$/.test(T)){return null}if(/^(\d{2}):(\d{2})(:(\d{2})(\.(\d+))?)?(Z|((\+|-)(\d{2}):(\d{2})))?$/.test(T)){return null}}var S;if(S=T.match(/^(\d{4})(-(\d{2})(-(\d{2})(T(\d{2}):(\d{2})(:(\d{2})(\.(\d+))?)?(Z|((\+|-)(\d{2}):(\d{2}))))?))$/)){var Q=S[12];if(Q){if(Q.length>3){Q=Math.round(Number(Q.substr(0,3)+"."+Q.substr(3)))}else{if(Q.length<3){Q+=Q.length===2?"0":"00"}}}var R=new Date(Date.UTC(Number(S[1]),(Number(S[3])-1)||0,Number(S[5])||0,Number(S[7])||0,Number(S[8])||0,Number(S[10])||0,Number(Q)||0));if(S[13]&&S[13]!=="Z"){var U=Number(S[16])||0,P=Number(S[17])||0;U*=3600000;P*=60000;var V=U+P;if(S[15]==="+"){V=-V}R=new Date(R.valueOf()+V)}return R}else{return null}}function K(Q,R){if(typeof R==="string"){var P=O(R);if(P){R=P}}return R}function H(T,Q){var P,R,S;for(P in T){if(T.hasOwnProperty(P)){R=T[P];S=Q(P,R);T[P]=S;if(R===S&&typeof R==="object"){H(R,Q)}}}}function C(P){H(P,K)}r._traverseAndRevive=C;function E(P){if(typeof P==="string"&&P.length>0){P=JSON.parse(P,K)}else{if(typeof P==="object"){C(P)}}if(P){return{result:P.Result,count:P.Count}}else{return P}}function F(P){if(typeof P==="string"&&P.length>0){try{P=JSON.parse(P);return{message:P.message,code:P.errorCode}}catch(Q){return P}}else{return P}}function M(P){if(typeof P==="string"&&P.length>0){P=JSON.parse(P,K)}else{if(typeof P==="object"){C(P)}}if(P){return{result:P.Result}}else{return P}}function I(P){if(typeof P==="string"&&P.length>0){P=JSON.parse(P,K)}else{if(typeof P==="object"){C(P)}}if(P){return{result:P.Result,ModifiedAt:P.ModifiedAt}}else{return P}}D.parsers={simple:{result:E,error:F},single:{result:M,error:F},update:{result:I,error:F}};r.disableRequestCache=function(P,S){if(S==="GET"){var Q=(new Date()).getTime();var R=P.indexOf("?")>-1?"&":"?";P+=R+"_el="+Q}return P};if(typeof r.sendRequest==="undefined"){r.sendRequest=function(Q){var P=Q.buildUrl(Q.setup)+Q.endpoint;P=r.disableRequestCache(P,Q.method);var R=Q.method==="GET"?Q.data:JSON.stringify(Q.data);k({url:P,method:Q.method,data:R,headers:Q.headers,type:"json",contentType:"application/json",crossOrigin:true,success:function(T,U,S){Q.success.call(Q,Q.parse.result(T))},error:function(S,U,T){Q.error.call(Q,Q.parse.error(S.responseText))}})}}return D}());r.getCallbacks=function(E,C){var D;if(typeof E!=="function"&&typeof C!=="function"){D=new i.Promise(function(G,F){E=function(H){G(H)};C=function(H){F(H)}})}return{promise:D,success:E,error:C}};function t(C,F,D){var E=r.getCallbacks(F,D);C(E.success,E.error);return E.promise}function y(C,D){return function(G,E){var F=G.result;if(z.isArray(C)||typeof C.length==="number"){z.each(C,function(I,H){z.extend(I,F[H])})}else{z.extend(C,F)}D(G,E)}}function j(C,D){return function(F){var E=F.ModifiedAt;C.ModifiedAt=E;D(F)}}function d(C,D){this.setup=C;this.collectionName=D;this.options=null}d.prototype={withHeaders:function(D){var C=this.options||{};C.headers=z.extend(C.headers||{},D);this.options=C;return this},expand:function(D){var C={"X-Everlive-Expand":JSON.stringify(D)};return this.withHeaders(C)},_createRequest:function(C){z.extend(C,this.options);this.options=null;return new u(this.setup,C)},get:function(E,F,D){var C=this;return t(function(I,G){var H=C._createRequest({method:"GET",endpoint:C.collectionName,filter:E,success:I,error:G});H.send()},F,D)},getById:function(F,E,D){var C=this;return t(function(I,G){var H=C._createRequest({method:"GET",endpoint:C.collectionName+"/"+F,parse:u.parsers.single,success:I,error:G});H.send()},E,D)},count:function(E,F,D){var C=this;return t(function(I,G){var H=C._createRequest({method:"GET",endpoint:C.collectionName+"/_count",filter:E,parse:u.parsers.single,success:I,error:G});H.send()},F,D)},create:function(E,F,D){var C=this;return t(function(I,G){var H=C._createRequest({method:"POST",endpoint:C.collectionName,data:E,parse:u.parsers.single,success:y(E,I),error:G});H.send()},F,D)},rawUpdate:function(E,F,G,D){var C=this;return t(function(L,I){var K=C.collectionName;var H=null;if(typeof F==="string"){K+="/"+F}else{if(typeof F==="object"){H=F}}var J=C._createRequest({method:"PUT",endpoint:K,data:E,filter:H,success:L,error:I});J.send()},G,D)},_update:function(E,G,I,F,H,D){var C=this;return t(function(O,J){var N=C.collectionName;var L=O;if(I){N+="/"+E[g];L=j(E,O)}var M={};M[F?"$replace":"$set"]=E;var K=C._createRequest({method:"PUT",endpoint:N,parse:u.parsers.update,data:M,filter:G,success:L,error:J});K.send()},H,D)},updateSingle:function(D,E,C){return this._update(D,null,true,false,E,C)},update:function(D,E,F,C){return this._update(D,E,false,false,F,C)},_destroy:function(E,F,H,G,D){var C=this;return t(function(L,I){var K=C.collectionName;if(H){K+="/"+E[g]}var J=C._createRequest({method:"DELETE",endpoint:K,filter:F,success:L,error:I});J.send()},G,D)},destroySingle:function(D,E,C){return this._destroy(D,null,true,E,C)},destroy:function(D,E,C){return this._destroy(null,D,false,E,C)},setAcl:function(G,E,F,D){var C=this;return t(function(L,H){var K=C.collectionName;if(typeof E==="string"){K+="/"+E}else{if(typeof E==="object"){K+="/"+E[g]}}K+="/_acl";var M,J;if(G===null){M="DELETE"}else{M="PUT";J=G}var I=C._createRequest({method:M,endpoint:K,data:J,success:L,error:H});I.send()},F,D)},setOwner:function(C,F,G,E){var D=this;return t(function(K,H){var J=D.collectionName;if(typeof F==="string"){J+="/"+F}else{if(typeof F==="object"){J+="/"+F[g]}}J+="/_owner";var I=D._createRequest({method:"PUT",endpoint:J,data:{Owner:C},success:K,error:H});I.send()},G,E)},save:function(F,G,E){var D=this;var C=this.isNew(F);return t(function(K,H){function J(L){L.type=C?"create":"update";K(L)}function I(L){L.type=C?"create":"update";H(L)}if(C){return D.create(F,J,I)}else{return D.updateSingle(F,J,I)}},G,E)},isNew:function(C){return typeof C[g]==="undefined"}};r.Data=d;function l(C,D){this.longitude=C||0;this.latitude=D||0}r.GeoPoint=l;var e={unauthenticated:"unauthenticated",masterKey:"masterKey",invalidAuthentication:"invalidAuthentication",authenticated:"authenticated"};r.AuthStatus=e;function h(C,F,H,E){if(C.masterKey){return t(function(J,I){J({status:e.masterKey})},H,E)}if(!C.token){return t(function(J,I){J({status:e.unauthenticated})},H,E)}var D;if(H){D=function(I){if(I&&I.code===601){H({status:e.invalidAuthentication})}else{E(I)}}}var G=F(H,D);if(G){G=G.then(function(I){return{status:e.authenticated,user:I.result}},function(I){if(I&&I.code===601){return{status:e.invalidAuthentication}}else{throw I}})}return G}r.prototype.authInfo=function(D,C){return h(this.setup,z.bind(this.Users.getById,this.Users,"me"),D,C)};var c=function(C){C._loginSuccess=function(F){var E=F.result;var D=this.setup;D.token=E.access_token;D.tokenType=E.token_type};C._logoutSuccess=function(){var D=this.setup;D.token=null;D.tokenType=null};C.register=function(I,G,F,H,E){a(I,"username");a(G,"password");var D={Username:I,Password:G};z.extend(D,F);return this.create(D,H,E)};C.login=function(H,F,G,E){var D=this;return t(function(K,I){var J=new u(D.setup,{method:"POST",endpoint:"oauth/token",data:{username:H,password:F,grant_type:"password"},authHeaders:false,parse:u.parsers.single,success:function(){D._loginSuccess.apply(D,arguments);K.apply(null,arguments)},error:I});J.send()},G,E)};C.currentUser=function(F,E){var D=this;return t(function(H,G){h(D.setup,z.bind(D.getById,D,"me")).then(function(I){if(typeof I.user!=="undefined"){H({result:I.user})}else{H({result:null})}},function(I){G(I)})},F,E)};C.changePassword=function(J,F,I,G,H,E){var D=this;return t(function(N,K){var M="Users/changepassword";if(G){M+="?keepTokens=true"}var L=new u(D.setup,{method:"POST",endpoint:M,data:{Username:J,Password:F,NewPassword:I},authHeaders:false,parse:u.parsers.single,success:N,error:K});L.send()},H,E)};C.logout=function(F,E){var D=this;return t(function(I,G){var H=new u(D.setup,{method:"GET",endpoint:"oauth/logout",success:function(){D._logoutSuccess.apply(D,arguments);I.apply(null,arguments)},error:G});H.send()},F,E)};C._loginWithProvider=function(F,H,G){var E={Identity:F};var D=this;return t(function(K,I){var J=new u(D.setup,{method:"POST",endpoint:"Users",data:E,authHeaders:false,parse:u.parsers.single,success:function(){D._loginSuccess.apply(D,arguments);K.apply(null,arguments)},error:I});J.send()},H,G)};C._linkWithProvider=function(E,G,H,F){var D=this;return t(function(K,I){var J=new u(D.setup,{method:"POST",endpoint:"Users/"+G+"/link",data:E,parse:u.parsers.single,success:K,error:I});J.send()},H,F)};C._unlinkFromProvider=function(H,G,I,F){var E={Provider:H};var D=this;return t(function(L,J){var K=new u(D.setup,{method:"POST",endpoint:"Users/"+G+"/unlink",data:E,parse:u.parsers.single,success:L,error:J});K.send()},I,F)};C.loginWithFacebook=function(F,G,E){var D={Provider:"Facebook",Token:F};return C._loginWithProvider(D,G,E)};C.linkWithFacebook=function(G,F,H,E){var D={Provider:"Facebook",Token:F};return C._linkWithProvider(D,G,H,E)};C.unlinkFromFacebook=function(E,F,D){return C._unlinkFromProvider("Facebook",E,F,D)};C.loginWithADFS=function(F,G,E){var D={Provider:"ADFS",Token:F};return C._loginWithProvider(D,G,E)};C.linkWithADFS=function(G,F,H,E){var D={Provider:"ADFS",Token:F};return C._linkWithProvider(D,G,H,E)};C.unlinkFromADFS=function(E,F,D){return C._unlinkFromProvider("ADFS",E,F,D)};C.loginWithLiveID=function(F,G,E){var D={Provider:"LiveID",Token:F};return C._loginWithProvider(D,G,E)};C.linkWithLiveID=function(G,F,H,E){var D={Provider:"LiveID",Token:F};return C._linkWithProvider(D,G,H,E)};C.unlinkFromLiveID=function(E,F,D){return C._unlinkFromProvider("LiveID",E,F,D)};C.loginWithGoogle=function(F,G,E){var D={Provider:"Google",Token:F};return C._loginWithProvider(D,G,E)};C.linkWithGoogle=function(G,F,H,E){var D={Provider:"Google",Token:F};return C._linkWithProvider(D,G,H,E)};C.unlinkFromGoogle=function(E,F,D){return C._unlinkFromProvider("Google",E,F,D)};C.loginWithTwitter=function(F,G,H,E){var D={Provider:"Twitter",Token:F,TokenSecret:G};return C._loginWithProvider(D,H,E)};C.linkWithTwitter=function(G,F,H,I,E){var D={Provider:"Twitter",Token:F,TokenSecret:H};return C._linkWithProvider(D,G,I,E)};C.unlinkFromTwitter=function(E,F,D){return C._unlinkFromProvider("Twitter",E,F,D)}};var n=function(C){C.getUploadUrl=function(){return r.buildUrl(this.setup)+this.collectionName};C.getDownloadUrl=function(D){return r.buildUrl(this.setup)+this.collectionName+"/"+D+"/Download"};C._getUpdateUrl=function(D){return this.collectionName+"/"+D+"/Content"};C.getUpdateUrl=function(D){return r.buildUrl(this.setup)+this._getUpdateUrl(D)};C.updateContent=function(D,G,H,F){var E=this;return t(function(L,I){var K=E._getUpdateUrl(D);var J=E._createRequest({method:"PUT",endpoint:K,data:G,success:L,error:I});J.send()},H,F)};C.getDownloadUrlById=function(D,G,F){var E=this;return t(function(J,H){var I=E._createRequest({method:"GET",endpoint:E.collectionName+"/"+D,parse:u.parsers.single,success:function(K){J(K.result.Uri)},error:H});I.send()},G,F)}};var A={WindowsPhone:1,Windows:2,Android:3,iOS:4,OSX:5,Blackberry:6,Nokia:7,Unknown:100};r.PushCallbacks={};var m=function(C){this._el=C;this._currentDevice;this.notifications=C.data("Push/Notifications");this.devices=C.data("Push/Devices")};m.prototype={currentDevice:function(C){if(!window.cordova){throw new Error("Error: currentDevice() can only be called from within a hybrid mobile app, after 'deviceready' event has been fired.")}if(!this._currentDevice){this._currentDevice=new b(this);this._currentDevice.emulatorMode=C}return this._currentDevice}};var o={iOS:{badge:true,sound:true,alert:true},android:{senderID:null},notificationCallbackAndroid:null,notificationCallbackIOS:null};var b=function(C){this._pushHandler=C;this._initSuccessCallback=null;this._initErrorCallback=null;this._globalFunctionSuffix=null;this.pushSettings=null;this.pushToken=null;this.isInitialized=false;this.isInitializing=false;this.emulatorMode=false};b.prototype={enableNotifications:function(C,E,D){this.pushSettings=C;return t(z.bind(this._initialize,this),E,D)},disableNotifications:function(E,D){var C=this;return this.unregister().then(function(){return t(function(H,G){if(C.emulatorMode){H()}else{var F=window.plugins.pushNotification;F.unregister(function(){C.isInitialized=false;H()},G)}},E,D)},D)},getRegistration:function(E,C){var D=this._getDeviceId();return this._pushHandler.devices.getById("HardwareId/"+D,E,C)},register:function(D,G,E){var C=this;var F={};if(D!==undefined){F.Parameters=D}return this._populateRegistrationObject(F).then(function(){return C._pushHandler.devices.create(F,G,E)},E)},unregister:function(E,C){var D=device.uuid;return this._pushHandler.devices.destroySingle({Id:"HardwareId/"+D},E,C)},updateRegistration:function(D,G,E){var C=this;var F={};if(D!==undefined){F.Parameters=D}return this._populateRegistrationObject(F).then(function(){F.Id="HardwareId/"+F.HardwareId;return C._pushHandler.devices.updateSingle(F,G,E)},E)},_initialize:function(N,L){var P=this;if(this.isInitializing){L(new Error("Push notifications are currently initializing."));return}if(!this.emulatorMode&&(!window.plugins||!window.plugins.pushNotification)){L(new Error("The push notifications plugin is not initialized."));return}if(!this.emulatorMode&&(!window.navigator||!window.navigator.globalization)){L(new Error("The globalization plugin is not initialized."));return}this._initSuccessCallback=N;this._initErrorCallback=L;if(this.isInitialized){this._deviceRegistrationSuccess(this.pushToken);return}if(this.emulatorMode){setTimeout(function(){P._deviceRegistrationSuccess("fake_push_token")},1000);return}this.isInitializing=true;var O=this._globalFunctionSuffix;if(!O){O=Date.now().toString();this._globalFunctionSuffix=O}var D=window.plugins.pushNotification;var G=this._getPlatformType(device.platform);if(G===A.iOS){var I="apnCallback_"+O;r.PushCallbacks[I]=z.bind(this._onNotificationAPN,this);var K=this.pushSettings.iOS;this._validateIOSSettings(K);K.ecb="Everlive.PushCallbacks."+I;D.register(z.bind(this._successfulRegistrationAPN,this),z.bind(this._failedRegistrationAPN,this),K)}else{if(G===A.Android){var C="gcmCallback_"+O;r.PushCallbacks[C]=z.bind(this._onNotificationGCM,this);var F=this.pushSettings.android;this._validateAndroidSettings(F);F.ecb="Everlive.PushCallbacks."+C;D.register(z.bind(this._successSentRegistrationGCM,this),z.bind(this._errorSentRegistrationGCM,this),F)}else{if(G===A.WindowsPhone){var H="wp8Callback_"+O;var M="wp8RegistrationSuccessCallback_"+O;var E="wp8RegistrationErrorCallback_"+O;r.PushCallbacks[H]=z.bind(this._onNotificationWP8,this);r.PushCallbacks[M]=z.bind(this._deviceRegistrationSuccessWP,this);r.PushCallbacks[E]=z.bind(this._deviceRegistrationFailed,this);var J=this.pushSettings.wp8;this._validateWP8Settings(J);J.ecb="Everlive.PushCallbacks."+H;J.uccb="Everlive.PushCallbacks."+M;J.errcb="Everlive.PushCallbacks."+E;D.register(z.bind(this._successSentRegistrationWP8,this),z.bind(this._errorSentRegistrationWP8,this),J)}else{throw new Error("The current platform is not supported: "+device.platform)}}}},_deviceRegistrationSuccessWP:function(C){this._deviceRegistrationSuccess(C.uri)},_validateAndroidSettings:function(C){if(!C.senderID){throw new Error("Sender ID (project number) is not set in the android settings.")}},_validateWP8Settings:function(C){if(!C.channelName){throw new Error("channelName is not set in the WP8 settings.")}},_validateIOSSettings:function(C){},_populateRegistrationObject:function(E,F,D){var C=this;return t(function(H,G){if(!C.pushToken){throw new Error("Push token is not available.")}C._getLocaleName(function(I){var O=C._getDeviceId();var M=device.name;var K=C._getPlatformType(device.platform);var L=f.determine().name();var J=C.pushToken;var P=I.value;var N=device.version;E.HardwareId=O;E.HardwareModel=M;E.PlatformType=K;E.PlatformVersion=N;E.TimeZone=L;E.PushToken=J;E.Locale=P;H()},G)},F,D)},_getLocaleName:function(D,C){if(this.emulatorMode){D({value:"en_US"})}else{navigator.globalization.getLocaleName(function(E){D(E)},C);navigator.globalization.getLocaleName(function(E){},C)}},_getDeviceId:function(){return device.uuid},_getPlatformType:function(D){var C=D.toLowerCase();switch(C){case"ios":case"iphone":case"ipad":return A.iOS;case"android":return A.Android;case"wince":return A.WindowsPhone;case"win32nt":return A.WindowsPhone;default:return A.Unknown}},_deviceRegistrationFailed:function(C){this.pushToken=null;this.isInitializing=false;this.isInitialized=false;if(this._initErrorCallback){this._initErrorCallback({error:C})}},_deviceRegistrationSuccess:function(C){this.pushToken=C;this.isInitializing=false;this.isInitialized=true;if(this._initSuccessCallback){this._initSuccessCallback({token:C})}},_successfulRegistrationAPN:function(C){this._deviceRegistrationSuccess(C)},_failedRegistrationAPN:function(C){this._deviceRegistrationFailed(C)},_successSentRegistrationGCM:function(C){},_successSentRegistrationWP8:function(C){},_errorSentRegistrationWP8:function(C){this._deviceRegistrationFailed(C)},_errorSentRegistrationGCM:function(C){this._deviceRegistrationFailed(C)},_onNotificationAPN:function(C){this._raiseNotificationEventIOS(C)},_onNotificationWP8:function(C){this._raiseNotificationEventWP8(C)},_onNotificationGCM:function w(C){switch(C.event){case"registered":if(C.regid.length>0){this._deviceRegistrationSuccess(C.regid)}break;case"message":this._raiseNotificationEventAndroid(C);break;case"error":if(!this.pushToken){this._deviceRegistrationFailed(C)}else{this._raiseNotificationEventAndroid(C)}break;default:this._raiseNotificationEventAndroid(C);break}},_raiseNotificationEventAndroid:function(C){if(this.pushSettings.notificationCallbackAndroid){this.pushSettings.notificationCallbackAndroid(C)}},_raiseNotificationEventIOS:function(C){if(this.pushSettings.notificationCallbackIOS){this.pushSettings.notificationCallbackIOS(C)}},_raiseNotificationEventWP8:function(C){if(this.pushSettings.notificationCallbackWP8){this.pushSettings.notificationCallbackWP8(C)}}};var x=function(){this.Users=this.data("Users");c(this.Users);this.Files=this.data("Files");n(this.Files);this.push=new m(this)};s.push({name:"default",func:x});return r}));

